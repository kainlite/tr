services:
   web:
       build: .
       # volumes:
       #   - type: bind
       #     source: .
       #     target: /app
       ports:
         - "4000:4000"
       environment:
         - RELEASE_DISTRIBUTION=web-1
         - POD_IP=localhost
         - DATABASE_URL=postgresql://postgres:postgres@db/tr_dev
         - SECRET_KEY_BASE="z0OiA5F+dY+TmM84E+Cl0/BzJETmpoV/uxX1GccnAnINMIj61NA8nGZFkJLA0hdG"
         - PHX_HOST=localhost
       depends_on:
         - db
   db:
      image: postgres:14.5
      environment:
        POSTGRES_USER: postgres
        POSTGRES_PASSWORD: postgres
        POSTGRES_DB: tr_dev 
        PGDATA: /var/lib/postgresql/data/pgdata
      restart: always
      volumes:
        - pgdata:/var/lib/postgresql/data
      ports:
        - 5432:5432
   ollama:
      image: ollama/ollama:latest
      restart: always
      volumes:
        - ollama:/root/.ollama
      ports:
        - 11434:11434
      # requires nvidia-container-toolkit
      deploy:
        resources:
          reservations:
            devices:
              - driver: nvidia
                count: 1
                capabilities: [gpu]
volumes:
   pgdata:
   ollama:
